<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Visor de Ejercicios</title>
  <style>
    #canvas {
      margin-top: 20px;
      width: 420px;
      height: 480px;
      border: 1px solid #ccc;
    }
  </style>

	<script src='node_modules/pilasweb/dist/pilasweb.js'></script>
	<script src='dist/pilas-bloques-exercises.js'></script>
</head>


<body onload="onload()">

    <div class='container'>
      <canvas id='canvas'></canvas>
    </div>

    <div class="selectorDeDesafios">
      <select id='selectDesafio'>
        <option>NoMeCansoDeSaltar</option>
        <option>ElGatoEnLaCalle</option>
        <option>SuperTito1</option>
        <option>SuperTito2</option>
        <option>AlienInicial</option>
        <option>AlienLevantaTuercas</option>
        <option>AlimentandoALosPeces</option>
        <option>Camino</option>
        <option>ElCangrejoAguafiestas</option>
        <option>ElMarcianoEnElDesierto</option>
        <option>ElMonoQueSabeContar</option>
        <option>ElRecolectorDeEstrellas</option>
        <option>FutbolRobots</option>
        <option>TitoEnciendeLuces</option>
        <option>InstalandoJuegos</option>
        <option>LaEleccionDelMono</option>
        <option>LaGranAventuraDelMarEncantado</option>
        <option>LaberintoConQueso</option>
        <option>LaberintoCorto</option>
        <option>TitoRecargado</option>
        <option>MariaLaComeSandias</option>
        <option>NoMeCansoDeSaltar</option>
        <option>PrendiendoLasCompus</option>
        <option>PrendiendoLasFogatas</option>
        <option>ReparandoLaNave</option>
        <option>SuperViaje</option>
        <option>TresHuesos</option>
      </select>
    </div>

  <script src="dist/imageList.js"></script>
  <script>
      function iniciar_canvas(nombreDesafio) {
    		var canvas_element = document.getElementById('canvas');
    		window['canvas'] = canvas_element;

    		var pilas = pilasengine.iniciar({
    			ancho: 420,
    			alto: 480,
          canvas: canvas_element,
          cargar_imagenes_estandar: false,
    			data_path: 'dist/data',
    	    imagenesExtra: imageList
        });

  		eval('pilas.mundo.gestor_escenas.cambiar_escena(new ' + nombreDesafio + '());');
      pilas.onready = function() {};
  		pilas.ejecutar();
    }

     function nombreDeClaseDesdeURL() {
         var hash = window.location.href.slice(window.location.href.indexOf('?') + 1);
         var name = hash.split('=')[1];
         if (name) {
           return name;
         } else {
           return "ElGatoEnLaCalle";
         }
     }

     function actualizar_url(desafio) {
       var url = window.location.href.split("?")[0] + "?desafio=" + desafio;
       window.history.pushState("", "", url);
     }

     function onload() {
       var selectDesafio = document.getElementById('selectDesafio');

       iniciar_canvas(nombreDeClaseDesdeURL());

		eval('pilas.mundo.gestor_escenas.cambiar_escena(new ' + nombreDeClaseDesdeURL() + '());');

		pilas.ejecutar();

       selectDesafio.onchange = function() {
         var nombre = selectDesafio.value;
         iniciar_canvas(nombre);
         actualizar_url(nombre);
       };
     }

   </script>

</body>
</html>
