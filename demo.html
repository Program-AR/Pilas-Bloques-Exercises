<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Visor de Ejercicios</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <style>
    .container {
      display: flex;
    }

    .canvas-container {
      display: flex;
      flex-direction: column;
    }

    #canvas {
      position: relative;
      width: 420px;
      height: 480px;
    }

    #editor {
      position: relative;
      width: 420px;
      height: 480px;
    }
  </style>

  <script src='node_modules/pilasweb/dist/pilasweb.js'></script>
  <script src='dist/pilas-bloques-exercises.js'></script>
</head>


<div class="container">

  <div class="canvas-container">
    <canvas id='canvas'></canvas>

    <select id='selectDesafio'>
      <option value="AlienInicial" selected>AlienInicial</option>
      <option value="ElGatoEnLaCalle">ElGatoEnLaCalle</option>
      <option value="NoMeCansoDeSaltar">NoMeCansoDeSaltar</option>
      <option value="ElMarcianoEnElDesierto">ElMarcianoEnElDesierto</option>
      <option value="TitoEnciendeLuces">TitoEnciendeLuces</option>
      <option value="AlienLevantaTuercas">AlienLevantaTuercas</option>
      <option value="ElRecolectorDeEstrellas">ElRecolectorDeEstrellas</option>
      <option value="MariaLaComeSandias">MariaLaComeSandias</option>
      <option value="AlimentandoALosPeces">AlimentandoALosPeces</option>
      <option value="InstalandoJuegos">InstalandoJuegos</option>
      <option value="LaGranAventuraDelMarEncantado">LaGranAventuraDelMarEncantado</option>
      <option value="ReparandoLaNave">ReparandoLaNave</option>
      <option value="ElMonoYLasBananas">ElMonoYLasBananas</option>
      <option value="LaEleccionDelMono">LaEleccionDelMono</option>
      <option value="LaberintoCorto">LaberintoCorto</option>
      <option value="TresNaranjas">TresNaranjas</option>
      <option value="TitoRecargado">TitoRecargado</option>
      <option value="LaberintoLargo">LaberintoLargo</option>
      <option value="SuperTito1">SuperTito1</option>
      <option value="SuperTito2">SuperTito2</option>
      <option value="LaberintoConQueso">LaberintoConQueso</option>
      <option value="ElDetectiveChaparro">ElDetectiveChaparro</option>
      <option value="FutbolRobots">FutbolRobots</option>
      <option value="PrendiendoLasCompus">PrendiendoLasCompus</option>
      <option value="ElMonoQueSabeContar">ElMonoQueSabeContar</option>
      <option value="SuperViaje">SuperViaje</option>
      <option value="ElMonoCuentaDeNuevo">ElMonoCuentaDeNuevo</option>
      <option value="ElPlanetaDeNano">ElPlanetaDeNano</option>
      <option value="DibujandoCuadrado">DibujandoAlCuadrado</option>
      <option value="Dibujando5CuadradosHorizontal">DibujandoRayuelaRobotica</option>
      <option value="Dibujando5CuadradosDiagonal">DibujandoCortoPorLaDiagonal</option>
      <option value="Dibujando4CuadradosInteriores">DibujandoMamushkaCuadrada</option>
      <option value="DibujandoCabezaElefante">DibujandoEscaleraCuadrada</option>
      <option value="DibujandoHexagono">DibujandoHexagono</option>
      <option value="DibujandoTrianguloEquilatero">DibujandoPiramideInvertida</option>
      <option value="DibujandoPoligonosInteriores">DibujandoFigurasDentroDeFiguras</option>
      <option value="DibujandoCuevaEstalagtitas">DibujandoLaCuevaDeEstalagtitas</option>
      <option value="LaFiestaDeDracula">LaFiestaDeDracula</option>
      <option value="SalvandoLaNavidad">SalvandoLaNavidad</option>
      <option value="PrendiendoLasCompus">PrendiendoLasCompusParametrizado</option>
      <option value="TitoCuadrado">TitoCuadrado</option>
      <option value="ElCangrejoAguafiestas">ElCangrejoAguafiestas</option>
      <option value="PrendiendoLasFogatas">PrendiendoLasFogatas</option>
      <option value="DibujandoLibremente">DibujoLibre</option>
      <option value="EscenaDuba1">3.1.2a</option>
      <option value="EscenaDuba2">3.1.2b</option>
      <option value="EscenaDuba3">3.1.2c</option>
      <option value="EscenaDuba4">3.1.2d</option>
      <option value="EscenaDuba5">3.1.2e</option>
      <option value="EscenaDuba6">3.1.2f</option>
      <option value="EscenaCoty1">3.1.3a</option>
      <option value="EscenaCoty2">3.1.3b</option>
      <option value="EscenaCoty3">3.1.3c</option>
      <option value="EscenaCotySonrisa">3.1.3d</option>
      <option value="EscenaCoty5">3.1.3e</option>
      <option value="EscenaCotyCactus">3.1.3f</option>
      <option value="EscenaCotyMate">3.1.3g</option>
      <option value="EscenaLita1">3.2.1g</option>
      <option value="EscenaLita2">3.2.2g</option>
      <option value="EscenaLita3">3.2.3g</option>
      <option value="EscenaLita4">3.2.4g</option>
      <option value="EscenaLita5">3.2.5g</option>
      <option value="EscenaLita6">3.2.6g</option>
      <option value="EscenaDuba7">3.2.3f</option>
      <option value="EscenaDuba8">3.2.4f</option>
      <option value="EscenaDuba9">3.2.5f</option>
      <option value="EscenaDuba10">3.2.6f</option>
    </select>
  </div>

  <div class="code-container">
    <div id="editor"></div>
    <input id="eval" type="button" value="eval" />
    <script src="scripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="scripts/ace/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
    <script>
      var JavaScriptMode = ace.require("ace/mode/javascript").Mode;
      var editor = ace.edit("editor");
      editor.session.setMode(new JavaScriptMode());
      document.getElementById("eval").onclick = function () { eval(editor.getValue()); };
    </script>
  </div>

</div>

<script type="module">
  import { imageList } from './dist/imageList.js';
  window["repeat"] = function repeat(n, f) { for (var i = 0; i < n; i++) { f(); } }
  function evalScene(nombreDesafio) {
    pilas.mundo.gestor_escenas.cambiar_escena(new (eval(nombreDesafio))());
    switch (nombreDesafio) {
      case "AlienInicial":
        editor.setValue(
          "   var escena = pilas.mundo.gestor_escenas.escena; \n" +
          "   var automata = escena.automata; \n" +
          "\n" +
          "   function moverseALaCasillaDerecha() {\n" +
          "       automata.hacer_luego(MoverACasillaDerecha); \n" +
          "   } \n" +
          "\n" +
          "   function apretarBoton() {\n" +
          "       var args = { \n" +
          "           etiqueta: 'BotonAnimado', \n" +
          "           nombreAnimacion: 'apretar', \n" +
          "           animacionInteractuadoAlFinal: 'prendida', \n" +
          "           mensajeError: 'No hay un botón aquí', \n" +
          "           idTransicion: 'apretarBoton' \n" +
          "       }; \n" +
          "       automata.hacer_luego(Interactuar, args); \n" +
          "   } \n" +
          "\n" +
          "   function programa() { \n" +
          "       repeat(3, moverseALaCasillaDerecha); \n" +
          "       apretarBoton(); \n" +
          "   }\n" +
          "\n" +
          "   programa();\n" +
          "\n");
        break;
      case "NoMeCansoDeSaltar":
        editor.setValue(
          "   var escena = pilas.mundo.gestor_escenas.escena; \n" +
          "   var automata = escena.automata; \n" +
          "\n" +
          "   function saltar() {\n" +
          "       var args = { \n" +
          "           velocidad_inicial: 30, \n" +
          "           alturaDeseada: 150, \n" +
          "           cantPasos: 20, \n" +
          "           velocidad: 50 \n" +
          "       }; \n" +
          "       automata.hacer_luego(SaltarHablando, args); \n" +
          "   } \n" +
          "\n" +
          "   function programa() { \n" +
          "       repeat(30, saltar); \n" +
          "   }\n" +
          "\n" +
          "   programa();\n" +
          "\n");
        break;
      default:
        editor.setValue(
          "   var escena = pilas.mundo.gestor_escenas.escena; \n" +
          "   var automata = escena.automata; \n" +
          "\n" +
          "   function programa() { \n" +
          "        \n" +
          "   }\n" +
          "\n" +
          "   programa();\n" +
          "\n");
        break;
    }
  }
  function iniciar_canvas(nombreDesafio) {
    var canvas_element = document.getElementById('canvas');
    window['canvas'] = canvas_element;
    var pilas = pilasengine.iniciar({
      ancho: 420,
      alto: 480,
      canvas: canvas_element,
      cargar_imagenes_estandar: false,
      data_path: 'dist/data',
      imagenesExtra: imageList
    });
    evalScene(nombreDesafio);
    pilas.onready = function () { };
    pilas.ejecutar();
  }
  window['onload'] = function onload() {
    var selectDesafio = document.getElementById('selectDesafio');
    var selectText = selectDesafio.options[selectDesafio.selectedIndex].text;
    var selectValue = selectDesafio.options[selectDesafio.selectedIndex].value;
    iniciar_canvas(selectValue);
    pilas.ejecutar();
    selectDesafio.onchange = function () {
      var text = selectDesafio.options[selectDesafio.selectedIndex].text;
      var value = selectDesafio.options[selectDesafio.selectedIndex].value;
      iniciar_canvas(value);
    };
  }
</script>

</body>

</html>